<!DOCTYPE html>
<html>

<style>
canvas {border: 3px solid red;}
</style>

<body>
<canvas width=300 height=350 id="myCanvas"></canvas>

<script>

//DO COLLISION DETECTION WITH THE INVISIBLE WALLS, NOT THE ACTUAL MAZE PICTURE!!!!



addEventListener("keydown", keyDown, false);
addEventListener("keyup", keyUp, false);

var canvas = document.getElementById("myCanvas");
var context = canvas.getContext("2d");

var myMaze = new Maze();
var myPacman = new Pacman();
var myRedGhost = new RedGhost();

//Wall(x, y, width, height)
var walls = [];
walls.push( new Wall(0, 0, 5, 350));
walls.push( new Wall(0, 345, 300, 5));

setInterval(animate, 60);

function animate(){
  clearBackground();
    doSomething();
    drawThings();
}

function clearBackground() {
	context.fillStyle = "white";
    context.fillRect(0, 0, canvas.width, canvas.height);
}

function doSomething(){
  myPacman.takeAction(3, 3);
}

function drawThings(){
  myMaze.drawMaze();
  myRedGhost.drawRghRight();
  for(var p in walls){
    walls[p].draw();
  }

  if(myPacman.facingUp == true){
		myPacman.drawPmUp();
	}

	if(myPacman.facingDown == true){
		myPacman.drawPmDown();
	}

	if(myPacman.facingLeft == true){
		myPacman.drawPmLeft();
	}

	if(myPacman.facingRight == true){
		myPacman.drawPmRight();
	}
}

function keyDown(evt) {
  if(evt.key == 'w'){
		myPacman.movingUp = true;

		myPacman.facingUp = true;
		myPacman.facingDown = false;
		myPacman.facingLeft = false;
		myPacman.facingRight = false;
	}

  else if(evt.key == 's'){
		myPacman.movingDown = true;

		myPacman.facingDown = true;
		myPacman.facingUp = false;
		myPacman.facingLeft = false;
		myPacman.facingRight = false;
	}

  else if(evt.key == 'a'){
		myPacman.movingLeft = true;

		myPacman.facingLeft = true;
		myPacman.facingUp = false;
		myPacman.facingDown = false;
		myPacman.facingRight = false;
	}

  else if(evt.key == 'd'){
		myPacman.movingRight = true;

		myPacman.facingRight = true;
		myPacman.facingUp = false;
		myPacman.facingDown = false;
		myPacman.facingLeft = false;
	}

  // var collisionAboutToHappen = false;
  //
  // if(detectCollision(myMaze, myPacman)){
  //   collisionAboutToHappen = true;
  // }
  //
  // if(collisionAboutToHappen == true){
  //   myPacman.takeAction(-3, -3);
  // }

}

function keyUp(evt) {
  if(evt.key == 'w')myPacman.movingUp = false;
  else if(evt.key == 's')myPacman.movingDown = false;
  else if(evt.key == 'a')myPacman.movingLeft = false;
  else if(evt.key == 'd')myPacman.movingRight = false;
}



function Pacman(){
  this.x = 13;
  this.y = 13;
  this.movingUp = false;
  this.movingDown = false;
  this.movingLeft = false;
  this.movingRight = false;

  this.facingUp = false;
	this.facingDown = false;
	this.facingLeft = false;
	this.facingRight = true;

  //for the sprite sheet
  this.numbImages = 3;
  this.currImage = 0;
  this.imageWidth= 16;
  this.imageHeight = 14;
  this.imageWidthVERTICAL = 14;
  this.imageHeightVERTICAL = 16;


  this.numbCols = 1;
  this.numbRows = 3;

  //image variables
  this.pmRight = new Image();
  this.pmRight.src = "images/pmRight.png";

  this.pmLeft = new Image();
  this.pmLeft.src = "images/pmLeft.png";

  this.pmUp = new Image();
  this.pmUp.src = "images/pmUp.png";

  this.pmDown = new Image();
  this.pmDown.src = "images/pmDown.png";

  //"draw" functions
  this.drawPmRight = function(){
    context.drawImage(this.pmRight, this.currImage*this.imageWidth, 0, this.imageWidth, this.imageHeight, this.x, this.y, this.imageWidth, this.imageHeight);
    this.currImage++;
    this.currImage %= this.numbImages;
  }

  this.drawPmLeft = function() {
    context.drawImage( this.pmLeft, this.currImage*this.imageWidth , 0, this.imageWidth, this.imageHeight, this.x, this.y, this.imageWidth, this.imageHeight );
    this.currImage++;
    this.currImage %= this.numbImages;
  }

  this.drawPmUp = function() {
		this.currRow = Math.floor(this.currImage / this.numbCols);
	  this.currCol = this.currImage % this.numbCols;
	  context.drawImage( this.pmUp, this.currCol*this.imageWidthVERTICAL , this.currRow*this.imageHeightVERTICAL, this.imageWidthVERTICAL, this.imageHeightVERTICAL, this.x, this.y, this.imageWidthVERTICAL, this.imageHeightVERTICAL );
	  this.currImage++;
	  this.currImage %= this.numbImages;
  }

  this.drawPmDown = function() {
		this.currRow = Math.floor(this.currImage / this.numbCols);
	  this.currCol = this.currImage % this.numbCols;
	  context.drawImage( this.pmDown, this.currCol*this.imageWidthVERTICAL , this.currRow*this.imageHeightVERTICAL, this.imageWidthVERTICAL, this.imageHeightVERTICAL, this.x, this.y, this.imageWidthVERTICAL, this.imageHeightVERTICAL );
	  this.currImage++;
	  this.currImage %= this.numbImages;
	}


  this.takeAction = function(dx, dy) {
    var origX = this.x;
    var origY = this.y;

    if(this.movingUp) this.y -= dy;
    else if(this.movingDown) this.y += dy;

    if(this.movingLeft) this.x -= dx;
    else if(this.movingRight) this.x += dx;

//clean up data...keep it onscreen...could also take any
//other actions at this point...or could take actions
//before the movement section above
    if(this.x < 0) this.x = 0;
    else if(this.x + this.imageWidth > canvas.width)
      this.x = canvas.width - this.imageWidth;

    if(this.y < 0) this.y = 0;
    else if(this.y + this.imageHeight > canvas.height)
      this.y = canvas.height - this.imageHeight;

      //check for collisions...use a loop over the array of walls
      var hitSomething = false;

      for( var p in walls ){
        if( detectCollision(walls[p], myPacman) ){
          hitSomething = true;
        }
      }
      if(hitSomething) {
        this.x = origX;
        this.y = origY;
      }

  }

}

  function Wall(x, y, w, h) {
    this.x = x;
    this.y = y;
    this.imageWidth = w;
    this.imageHeight = h;

    this.draw = function(){
      context.fillRect(this.x, this.y, this.imageWidth, this.imageHeight);
    }
  }


  function RedGhost(){
    this.x = 225;
    this.y = 225;
    this.speed = 3;

    //for the sprite sheet
    this.numbImages = 2;
    this.currImage = 0;
    this.imageWidth= 16;
    this.imageHeight = 17;

    this.RghRight = new Image();
    this.RghRight.src = "images/RghRight.png";

    this.drawRghRight = function(){
      context.drawImage(this.RghRight, this.currImage*this.imageWidth, 0, this.imageWidth, this.imageHeight, this.x, this.y, this.imageWidth, this.imageHeight);
      this.currImage++;
      this.currImage %= this.numbImages;
    }
  }




  function Maze(){
    this.x = 0;
    this.y = 0;

    this.width = 300;
    this.height = 350;

    this.baseImage = new Image();
    this.baseImage.src = 'images/maze.png';

    this.drawMaze = function(){
      context.drawImage(this.baseImage, this.x, this.y, this.width, this.height);
    }
  }





function detectCollision(obj1, obj2) {

  return (	obj1.x < obj2.x + obj2.imageWidth &&
  			obj1.x + obj1.imageWidth > obj2.x &&
            obj1.y < obj2.y + obj2.imageHeight &&
            obj1.y + obj1.imageHeight > obj2.y );
}

</script>

</body>

</html>
