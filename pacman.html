<!DOCTYPE html>
<html>


<style>
canvas {border: 3px solid red;}
</style>

<body>
<canvas width=270 height=300 id="myCanvas"></canvas>

<p id ="demo"></p>

<script>

//DO COLLISION DETECTION WITH THE INVISIBLE WALLS, NOT THE ACTUAL MAZE PICTURE!!!!


addEventListener("keydown", keyDown, false);
// addEventListener("keyup", keyUp, false);

var canvas = document.getElementById("myCanvas");
var context = canvas.getContext("2d");

var myMaze = new Maze();
var myPacman = new Pacman();
var myRedGhost = new Ghost("red");
var myPinkGhost = new Ghost("pink");
var myBlueGhost = new Ghost("blue");
var myYellowGhost = new Ghost("yellow");


//Wall(x, y, width, height)
var walls = [];
walls.push(new Wall(0, 0, 5, 350, "clear")); //left edge
walls.push(new Wall(0, 295, 300, 5)); //bottom edge
walls.push(new Wall(0, 0, 300, 5)); //top edge
walls.push(new Wall(265, 0, 5, 350)); //right edge

walls.push(new Wall(23, 23, 31, 22)); //first row
walls.push(new Wall(72, 23, 41, 22));
walls.push(new Wall(130, 0, 10, 44));
walls.push(new Wall(158, 23, 41, 22));
walls.push(new Wall(217, 23, 31, 22));

walls.push(new Wall(23, 62, 31, 12)); //second row
walls.push(new Wall(72, 62, 11, 70));
walls.push(new Wall(101, 62, 69, 12));
walls.push(new Wall(188, 62, 12, 70));
walls.push(new Wall(217, 62, 30, 12));

walls.push(new Wall(0, 92, 54, 40)); //third row w/ the big squares
walls.push(new Wall(72, 92, 40, 11));
walls.push(new Wall(130, 62, 11, 41));
walls.push(new Wall(159, 92, 40, 11));
walls.push(new Wall(217, 92, 54, 40));

walls.push(new Wall(0, 150, 54, 40)); //fourth row w/ the big squares
walls.push(new Wall(72, 150, 11, 40));
walls.push(new Wall(101, 178, 69, 12));
walls.push(new Wall(188, 150, 12, 40));
walls.push(new Wall(217, 150, 54, 40));

walls.push(new Wall(23, 208, 30, 11)); //fifth row ;; h h v h h
walls.push(new Wall(72, 208, 41, 11));
walls.push(new Wall(130, 178, 11, 41));
walls.push(new Wall(159, 208, 41, 11));
walls.push(new Wall(217, 208, 30, 10));

walls.push(new Wall(0, 236, 25, 11)); //sixth row with the lil ones ;; h v v h v v h
walls.push(new Wall(43, 208, 11, 39));
walls.push(new Wall(72, 236, 11, 39));
walls.push(new Wall(101, 236, 69, 11));
walls.push(new Wall(188, 236, 11, 39));
walls.push(new Wall(217, 208, 11, 39));
walls.push(new Wall(246, 236, 25, 11));

walls.push(new Wall(23, 265, 89, 12)); //last row
walls.push(new Wall(130, 236, 10, 41));
walls.push(new Wall(159, 265, 89, 12));

//middle square
walls.push(new Wall(100, 121, 26, 5)); //top left
walls.push(new Wall(144, 121, 26, 5)); //top right
walls.push(new Wall(100, 121, 5, 41)); //left
walls.push(new Wall(165, 121, 5, 41)); //right
walls.push(new Wall(100, 154, 65, 8));

setInterval(animate, 60);

function animate(){
  clearBackground();
    doSomething();
    drawThings();

}

function clearBackground() {
	context.fillStyle = "black";
    context.fillRect(0, 0, canvas.width, canvas.height);
}


function doSomething(){
  myPacman.takeAction(3, 3);
  myRedGhost.takeAction();
  myPinkGhost.takeAction();
  myBlueGhost.takeAction();
  myYellowGhost.takeAction();
}

function drawThings(){

  for(var p in walls){
    walls[p].draw();
  }

  myMaze.drawMaze();

  if(myPacman.facingUp == true){
		myPacman.drawPmUp();
	}

	if(myPacman.facingDown == true){
		myPacman.drawPmDown();
	}

	if(myPacman.facingLeft == true){
		myPacman.drawPmLeft();
	}

	if(myPacman.facingRight == true){
		myPacman.drawPmRight();
	}


//red ghost
  if(myRedGhost.movingRight == true){
    myRedGhost.drawRight();
  }
  if(myRedGhost.movingLeft == true){
    myRedGhost.drawLeft();
  }

  if(myRedGhost.movingUp == true){
    myRedGhost.drawUp();
  }

  if(myRedGhost.movingDown == true){
    myRedGhost.drawDown();
  }
//pink ghost
  if(myPinkGhost.movingRight == true){
    myPinkGhost.drawRight();
  }
  if(myPinkGhost.movingLeft == true){
    myPinkGhost.drawLeft();
  }

  if(myPinkGhost.movingUp == true){
    myPinkGhost.drawUp();
  }

  if(myPinkGhost.movingDown == true){
    myPinkGhost.drawDown();
  }
//blue ghost
  if(myBlueGhost.movingRight == true){
    myBlueGhost.drawRight();
  }
  if(myBlueGhost.movingLeft == true){
    myBlueGhost.drawLeft();
  }

  if(myBlueGhost.movingUp == true){
    myBlueGhost.drawUp();
  }

  if(myBlueGhost.movingDown == true){
    myBlueGhost.drawDown();
  }
//yellow ghost
  if(myYellowGhost.movingRight == true){
    myYellowGhost.drawRight();
  }
  if(myYellowGhost.movingLeft == true){
    myYellowGhost.drawLeft();
  }

  if(myYellowGhost.movingUp == true){
    myYellowGhost.drawUp();
  }

  if(myYellowGhost.movingDown == true){
    myYellowGhost.drawDown();
  }

}

function keyDown(evt) {
  myPacman.movingUp = false;
  myPacman.movingDown = false;
  myPacman.movingLeft = false;
  myPacman.movingRight = false;

  if(evt.key == 'w'){
		myPacman.movingUp = true;

		myPacman.facingUp = true;
		myPacman.facingDown = false;
		myPacman.facingLeft = false;
		myPacman.facingRight = false;
	}

  else if(evt.key == 's'){
		myPacman.movingDown = true;

		myPacman.facingDown = true;
		myPacman.facingUp = false;
		myPacman.facingLeft = false;
		myPacman.facingRight = false;
	}

  else if(evt.key == 'a'){
		myPacman.movingLeft = true;

		myPacman.facingLeft = true;
		myPacman.facingUp = false;
		myPacman.facingDown = false;
		myPacman.facingRight = false;
	}

  else if(evt.key == 'd'){
		myPacman.movingRight = true;

		myPacman.facingRight = true;
		myPacman.facingUp = false;
		myPacman.facingDown = false;
		myPacman.facingLeft = false;
	}

}




function Pacman(){
  this.x = 6;
  this.y = 6;
  this.movingUp = false;
  this.movingDown = false;
  this.movingLeft = false;
  this.movingRight = false;

  this.facingUp = false;
	this.facingDown = false;
	this.facingLeft = false;
	this.facingRight = true;

  //for the sprite sheet
  this.numbImages = 3;
  this.currImage = 0;
  this.imageWidthSS = 16;
  this.imageHeightSS = 14;
  this.imageWidth= 16;
  this.imageHeight = 16;
  this.imageWidthVERTICAL = 14;
  this.imageHeightVERTICAL = 16;


  this.numbCols = 1;
  this.numbRows = 3;

  //image variables
  this.pmRight = new Image();
  this.pmRight.src = "images/pmRight.png";

  this.pmLeft = new Image();
  this.pmLeft.src = "images/pmLeft.png";

  this.pmUp = new Image();
  this.pmUp.src = "images/pmUp.png";

  this.pmDown = new Image();
  this.pmDown.src = "images/pmDown.png";

  //"draw" functions
  this.drawPmRight = function(){
    context.drawImage(this.pmRight, this.currImage*this.imageWidthSS, 0, this.imageWidthSS, this.imageHeight, this.x, this.y, this.imageWidth, this.imageHeight);

    this.currImage++;
    this.currImage %= this.numbImages;
  }

  this.drawPmLeft = function() {
    context.drawImage( this.pmLeft, this.currImage*this.imageWidthSS , 0, this.imageWidthSS, this.imageHeight, this.x, this.y, this.imageWidth, this.imageHeight );

    this.currImage++;
    this.currImage %= this.numbImages;
  }

  this.drawPmUp = function() {
		this.currRow = Math.floor(this.currImage / this.numbCols);
	  this.currCol = this.currImage % this.numbCols;
	  context.drawImage( this.pmUp, this.currCol*this.imageWidthVERTICAL , this.currRow*this.imageHeightVERTICAL, this.imageWidthVERTICAL, this.imageHeightVERTICAL, this.x, this.y, this.imageWidth, this.imageHeight );

    this.currImage++;
	  this.currImage %= this.numbImages;
  }

  this.drawPmDown = function() {
		this.currRow = Math.floor(this.currImage / this.numbCols);
	  this.currCol = this.currImage % this.numbCols;
	  context.drawImage( this.pmDown, this.currCol*this.imageWidthVERTICAL , this.currRow*this.imageHeightVERTICAL, this.imageWidthVERTICAL, this.imageHeightVERTICAL, this.x, this.y, this.imageWidth, this.imageHeight );

    this.currImage++;
	  this.currImage %= this.numbImages;
	}


  this.takeAction = function(dx, dy) {
    var origX = this.x;
    var origY = this.y;

    if(this.movingUp) this.y -= dy;
    else if(this.movingDown) this.y += dy;

    if(this.movingLeft) this.x -= dx;
    else if(this.movingRight) this.x += dx;

//clean up data...keep it onscreen...could also take any
//other actions at this point...or could take actions
//before the movement section above
    if(this.x < 0) this.x = 0;
    else if(this.x + this.imageWidth > canvas.width)
      this.x = canvas.width - this.imageWidth;

    if(this.y < 0) this.y = 0;
    else if(this.y + this.imageHeight > canvas.height)
      this.y = canvas.height - this.imageHeight;


      //check for collisions...use a loop over the array of walls
      var pmHitWall = false;

      for( var p in walls ){
        if( detectCollision(walls[p], myPacman) ){
          pmHitWall = true;
        }
      }
      if(pmHitWall) {
        this.x = origX;
        this.y = origY;
      }
  }
}


  function Ghost(clr) {

    this.color = clr;
    this.x = 110;
    this.y = 130;
    this.dx = 3;
    this.dy = 3;

    this.movingUp = false;
    this.movingDown = false;
    this.movingLeft = false;
    this.movingRight = false;

    //for the sprite sheet
    this.numbImages = 2;
    this.currImage = 0;

    this.imageWidth= 16;
    this.imageHeight = 16;

    this.RESPAWN_1 = 0;
    this.RESPAWN_2 = 1;
    this.EXIT_JAIL_1 = 2;
    this.EXIT_JAIL_2 = 3;
    this.EXIT_JAIL_3 = 4;
    this.NORMAL = 5;


    this.Right = new Image();
    this.Left = new Image();
    this.Up = new Image();
    this.Down = new Image();

    if(clr == "red") {
      this.currentState = this.RESPAWN_1;

      this.Right.src = "images/RghRight.png";
      this.Left.src = "images/RghLeft.png";
      this.Up.src = "images/RghUp.png";
      this.Down.src = "images/RghDown.png";
    }
    else if(clr == "pink") {
      this.currentState = this.RESPAWN_2;

      this.Right.src = "images/PghRight.png";
      this.Left.src = "images/PghLeft.png";
      this.Up.src = "images/PghUp.png";
      this.Down.src = "images/PghDown.png";
     }
    else if(clr == "blue"){
      this.currentState = this.RESPAWN_1;

      this.Right.src = "images/BghRight.png";
      this.Left.src = "images/BghLeft.png";
      this.Up.src = "images/BghUp.png";
      this.Down.src = "images/BghDown.png";
    }
    else if(clr == "yellow"){
      this.currentState = this.RESPAWN_2;

      this.Right.src = "images/YghRight.png";
      this.Left.src = "images/YghLeft.png";
      this.Up.src = "images/YghUp.png";
      this.Down.src = "images/YghDown.png";
    }

    this.drawRight = function(){
      context.drawImage(this.Right, this.currImage*this.imageWidth, 0, this.imageWidth, this.imageHeight, this.x, this.y, this.imageWidth, this.imageHeight);
      this.currImage++;
      this.currImage %= this.numbImages;
    }

    this.drawLeft = function(){
      context.drawImage(this.Left, this.currImage*this.imageWidth, 0, this.imageWidth, this.imageHeight, this.x, this.y, this.imageWidth, this.imageHeight);
      this.currImage++;
      this.currImage %= this.numbImages;
    }

    this.drawUp = function(){
      context.drawImage(this.Up, this.currImage*this.imageWidth, 0, this.imageWidth, this.imageHeight, this.x, this.y, this.imageWidth, this.imageHeight);
      this.currImage++;
      this.currImage %= this.numbImages;
    }

    this.drawDown = function(){
      context.drawImage(this.Down, this.currImage*this.imageWidth, 0, this.imageWidth, this.imageHeight, this.x, this.y, this.imageWidth, this.imageHeight);
      this.currImage++;
      this.currImage %= this.numbImages;
    }


    this.takeAction = function() {

      if(this.currentState == this.RESPAWN_1) {
        this.movingRight = true;
        this.x = 110;
        this.y = 130;
        this.currentState = this.EXIT_JAIL_1;
      }

      if(this.currentState == this.RESPAWN_2) {
        this.movingLeft = true;
        this.x = 140;
        this.y = 130;
        this.currentState = this.EXIT_JAIL_3;
      }

      else if(this.currentState == this.EXIT_JAIL_1) { //if you start on left side
          this.x += this.dx;
          if(this.x >= 130)
            this.currentState = this.EXIT_JAIL_2;
      }

      else if (this.currentState == this.EXIT_JAIL_3){ //if you start on right side
          this.x -= this.dx;
          if(this.x <= 130)
            this.currentState = this.EXIT_JAIL_2;
      }

      else if(this.currentState == this.EXIT_JAIL_2) { //going up
          this.y -= this.dy;
          if(this.y <= 105)
            this.currentState = this.NORMAL;
      }


      else if(this.currentState == this.NORMAL) {
        var OrigX = this.x;
        var OrigY = this.y;

        if(this.movingRight) this.x += this.dx;
        else if(this.movingLeft) this.x -= this.dx;
        else if(this.movingUp) this.y -= this.dy;
        else if(this.movingDown) this.y += this.dy;

        //use state machine
        //collision detection with wall, randomly change directions
        var ghHitWall = false;

        if(this.color == "red"){
          for( var p in walls ){
            if( detectCollision(walls[p], myRedGhost ) ){
              ghHitWall = true;
            }
          }
        }
        else if(this.color == "pink"){
          for( var p in walls ){
            if( detectCollision(walls[p], myPinkGhost ) ){
              ghHitWall = true;
            }
          }
        }
        else if(this.color == "blue"){
          for( var p in walls ){
            if( detectCollision(walls[p], myBlueGhost ) ){
              ghHitWall = true;
            }
          }
        }
        else if(this.color == "yellow"){
          for( var p in walls ){
            if( detectCollision(walls[p], myYellowGhost ) ){
              ghHitWall = true;
            }
          }
        }

          if(ghHitWall == true){

            var state = Math.floor(Math.random() * 4) + 1;

            // this.x = RghOrigX;
            // this.y = RghOrigY;
              if(state == 1){
                this.x = OrigX;
                this.y = OrigY;
                this.movingRight = true;

                this.movingLeft = false;
                this.movingUp = false;
                this.movingDown = false;


              }

              if(state == 2){
                this.x = OrigX;
                this.y = OrigY;
                this.movingLeft = true;

                this.movingRight = false;
                this.movingUp = false;
                this.movingDown = false;

              }

              if(state == 3){
                this.x = OrigX;
                this.y = OrigY;
                this.movingUp = true;

                this.movingDown = false;
                this.movingRight = false;
                this.movingLeft = false;

              }

              if(state == 4){
                this.x = OrigX;
                this.y = OrigY;
                this.movingDown = true;

                this.movingUp = false;
                this.movingRight = false;
                this.movingLeft = false;
            }

          } //if collision detection is true

      } //in currentState

    } //takeAction

  } //Ghost object


  //function Wall(x, y, w, h, c){} <<< c for color "clear"
    function Wall(x, y, w, h, c) {
      this.x = x;
      this.y = y;
      this.imageWidth = w;
      this.imageHeight = h;
      this.color = c;

      this.draw = function(){
        context.fillStyle = this.color;
        context.fillRect(this.x, this.y, this.imageWidth, this.imageHeight);
      }
    }

  function Maze(){
    this.x = 0;
    this.y = 0;

    this.width = 270;
    this.height = 300;

    this.baseImage = new Image();
    this.baseImage.src = 'images/maze.png';

    this.drawMaze = function(){
      context.drawImage(this.baseImage, this.x, this.y, this.width, this.height);
    }
  }




function detectCollision(obj1, obj2) {

  return (	obj1.x < obj2.x + obj2.imageWidth &&
  			obj1.x + obj1.imageWidth > obj2.x &&
            obj1.y < obj2.y + obj2.imageHeight &&
            obj1.y + obj1.imageHeight > obj2.y );
}

</script>

</body>

</html>
